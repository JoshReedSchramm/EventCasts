<%= javascript_include_tag "message_persister.js" %>
<%= javascript_include_tag "tweet_puller.js" %>

<script>
	var autoload = <%=@autoload%>;
	var twitter_search_url = "<%= @twitter_search_url %>";
	var event_id = <%= @event.id %>;
	var twitter_last_message_id = <%= @twitter_last_message_id %>;
	var ec_last_message_id = <%= @twitter_last_message_id %>;	
</script>
<%= javascript_include_tag "events" %>

<div id='json'></div>

<% if @event.nil? %>
	Unable to find event
<% end %>
<div id='main_content'>
    <h2><%= @event.name %></h2>
    <div id="live_feed">
        <div id="eventRecentTweets">
            <ul>
                <li id="messageTemplate" class='tweet'>
                    <hr class='tweet_rule' />
                    <img src='/images/fakeAvatar.jpg' alt='' class='profile_image' height="48px" width="48px"/>
                    <div class='tweet_info'>
                        <span class="tweeter"><a href='#'></a></span>
                        <span class="update_stamp"></span>
                    </div>
                    <div class='tweet'></div>
                    <div class='clear'></div>
                </li>
				<%  @event.messages.each do |message| %>
					<li class='tweet'>
	                    <hr class='tweet_rule' />
	                    <img src='<%= message.profile_image_url %>' alt='' class='profile_image' height="48px" width="48px"/>
	                    <div class='tweet_info'>
	                        <span class="tweeter"><a href='<%= message.origin_url %><%= message.from_user %>>'>@<%=message.from_user %></a></span>
	                        <span class="update_stamp"><%= distance_of_time_in_words(message.created, Time.now) %> ago</span>
	                    </div>
	                    <div class='tweet'><%= message.text %></div>
	                    <div class='clear'></div>
	                </li>
				<% end unless @event.messages.nil? %>
            </ul>
        </div>		
        <form>
            <input type="hidden" id="sinceTweetId" value="0" />
        </form>
    </div>
</div>
<div id="sidebar">
	<%= render :partial => "search_terms" %>
	<em>search terms</em>
	<br /><br />		
	<h4>
		<%= @event.description.blank? ? "No event description set" : @event.description.gsub(/\n/, '<br />') %>
	</h4>
	<em>description</em>	
	<br/><br/>
</div>