<%= javascript_include_tag "events" %>
<%= javascript_include_tag "event_data_editing.js" %>
<%= javascript_include_tag "jquery.form.js" %>

<% if @event.nil? %>
	Unable to find event
<% end %>

<div id="live_feed">
	<img id='loading_graphic' src='images/ajax-loader.gif'>	
	<div id="eventRecentTweets">
		<ul>
	    	<li id="tweetTemplate" class='tweet'>
				<hr class='tweet_rule' />
				<img src='/images/fakeAvatar.jpg' alt='' class='profile_image' height="48px" width="48px"/>
				<div class='tweet_info'>
	        		<span class="tweeter"><a href='#'></a></span>				
	        		<span class="update_stamp"></span>					
				</div>
				<div class='tweet'></div>
				<div class='clear'></div>
	      	</li>
		</ul>
	</div>
	<form>
		<input type="hidden" id="sinceTweetId" value="0" />
	</form>
</div>
<div id="sidebar">
	<h2>#<%=@event.name%></h2>
	<em>
		hashtag 
	</em>
	<br /><br />
	
	<h3>
		<%= "<a href='javascript:void(0)' class='edit_inline_link' id='edit_title_inline_link'>" if User.can_edit_event?(@event, session[:twitter_name])  %>
		<%= @event.title == "" ? 'No event short name set' : @event.title %>
		<%= "</a>"  if User.can_edit_event?(@event, session[:twitter_name])  %>
	</h3>

	<% 
	if User.can_edit_event?(@event, session[:twitter_name])  
		form_for :event_datum, :url => "/event_data/set_data?format=json", :html => { :id => "title_form", :class=>"event_data_form" } do |p| %>
		<%= p.text_field :description, :size=>30, :maxlength=>140, :id=>'title_box', :value=>@event.title %>
		<%= p.hidden_field :event_id, :value=>@event.id %>
		<%= p.hidden_field :event_data_type_id, :value=>EventDataType.title.id %>
		<%= p.submit "save", :class => "submit, submit_button" %>	
		<% end
	 end %>
	<em>short name 
		<%= "<a href='javascript:void(0)' class='edit_data_link' id='edit_title_link'>edit</a><a href='javascript:void(0)' class='save_data_link' id='save_title_link'>save</a>"  if User.can_edit_event?(@event, session[:twitter_name])  %>
	</em>	
	<br/><br/>
	
	<h4>
		<%= "<a href='javascript:void(0)' class='edit_inline_link' id='edit_description_inline_link'>"  if User.can_edit_event?(@event, session[:twitter_name])    %>
		<%= @event.description == "" ? "No event description set" : @event.description.gsub(/\n/, '<br />') %>
		<%= "</a>"  if User.can_edit_event?(@event, session[:twitter_name])   %>
	</h4>
	<% 
 	if User.can_edit_event?(@event, session[:twitter_name])  	
		form_for :event_datum, :url => "/event_data/set_data?format=json", :html => { :id => "description_form", :class=>"event_data_form" } do |p| %>
			<%= p.text_area :description, :rows=>6, :cols=>30, :maxlength=>140, :id=>'description_box', :value=>@event.description %>
			<%= p.hidden_field :event_id, :value=>@event.id %>
			<%= p.hidden_field :event_data_type_id, :value=>EventDataType.description.id %>
			<%= p.submit "save", :class => "submit, submit_button" %>	
		<% end 
	end %>	
	<em>description 
		<%= "<a href='javascript:void(0)' class='edit_data_link' id='edit_description_link'>edit</a><a href='javascript:void(0)' class='save_data_link' id='save_description_link'>save</a>"  if User.can_edit_event?(@event, session[:twitter_name])    %>
	</em>	
	<br/><br/>
	
	<div id='vips'>
		<div id='vip_content'>
			<%= render :partial => "vips" %>
		</div>
		<em>organizers / VIPs</em>
		<% if User.can_edit_event?(@event, session[:twitter_name])   %>
			<a id='add_vip_link' href='javascript:void(0);'>Add event VIP</a>
			<a id='cancel_add_vip_link' href='javascript:void(0);'>cancel</a>
			<div id='add_vip'>
				<% form_for [:event,@vip_user], :url => {:action=>"add_event_vip"}, :html => { :id => "add_vip_form" } do |p| %>
					<%= p.label :name, "twitter user: " %>
					<%= p.text_field :twitter_name, :size=>20, :maxlength=>140, :id=>'add_vip_box' %>
					<%= p.hidden_field :event_id, :value=>@event.id %>
					<a href='javascript:void(0)' id='save_vip_link'>save</a>
					<%= p.submit "Create VIP", :class => "submit, submit_button" %>
				<% end %>
			</div>
		<% end %>
		
	</div>	
	<div id='participants'>
		<%= render :partial => "participants" %>
		<br />		
		<em>participants</em>
	</div>
	
	<div id='sub_events'>
		<div id='subevent_list'>
			<%= render :partial => "event_heirarchy" %>
		</div>
		
		<em>related events</em> 
		<% if User.can_edit_event?(@event, session[:twitter_name])   %>
			<a id='add_subevent_link' href='javascript:void(0);'>Add sub-event</a>
			<a id='cancel_add_subevent_link' href='javascript:void(0);'>cancel</a>
			<div id='add_sub_event'>
				<% form_for :event, :url => {:action=>"new"}, :html => { :id => "add_sub_event_form" } do |p| %>
					<%= p.label :name, "hashtag: " %>
					<%= p.text_field :name, :size=>20, :maxlength=>140, :id=>'add_subevent_box' %>
					<a href='javascript:void(0)' id='save_subevent_link'>save</a>
					<%= p.submit "Create event", :class => "submit, submit_button" %>				
				<% end %>
			</div>
		<% end %>
	</div>
</div>

